<script>
    function reparseValidation()
    {
        var form = $('#create-course-form');
        form.removeData("validator");
        form.removeData("unobtrusiveValidation");
        $.validator.unobtrusive.parse(form);
    }

    async function addSkillToViewModel()
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        const response = await fetch('@Url.Action("AddSkillToViewModel", "Skill")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-skills-container").innerHTML = await response.text();
        reparseValidation()
    }

    async function removeSkillFromViewModel(idx)
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        formData.append("idx", idx);

        const response = await fetch('@Url.Action("RemoveSkillFromViewModel", "Skill")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-skills-container").innerHTML = await response.text();
        reparseValidation()
    }

    async function addVideoToViewModel()
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        const response = await fetch('@Url.Action("AddVideoToViewModel", "Material")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-videos-container").innerHTML = await response.text();
        reparseValidation()
    }

    async function removeVideoFromViewModel(idx)
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        formData.append("idx", idx);

        const response = await fetch('@Url.Action("RemoveVideoFromViewModel", "Material")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-videos-container").innerHTML = await response.text();
        reparseValidation()
    }

    async function addPublicationToViewModel()
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        const response = await fetch('@Url.Action("AddPublicationToViewModel", "Material")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-publications-container").innerHTML = await response.text();
        reparseValidation()
    }

    async function removePublicationFromViewModel(idx)
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        formData.append("idx", idx);

        const response = await fetch('@Url.Action("RemovePublicationFromViewModel", "Material")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-publications-container").innerHTML = await response.text();
        reparseValidation()
    }

    async function addArticleToViewModel()
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        const response = await fetch('@Url.Action("AddArticleToViewModel", "Material")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-articles-container").innerHTML = await response.text();
        reparseValidation()
    }

    async function removeArticleFromViewModel(idx)
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        formData.append("idx", idx);

        const response = await fetch('@Url.Action("RemoveArticleFromViewModel", "Material")', {
            method: "POST",
            body: formData
        });
        document.getElementById("create-articles-container").innerHTML = await response.text();
        reparseValidation()
    }

    function registerLoadVideosModal()
    {
        const loadVideosModal = document.getElementById("load-videos-modal");
        const openLoadVideosModalButton = document.getElementById("open-load-videos-button");
        const loadVideosList = document.getElementById("load-videos-list");

        openLoadVideosModalButton.addEventListener('click', () => loadVideosModal.showModal());
        loadVideosList.addEventListener("pointerdown", (e) =>
        {
            const label = e.target.closest(".load-video-item");
            if (!label) return;

            const id = label.dataset.id;
            const title = label.dataset.title;

            console.log(`id: ${id}, title: ${title}`)
            loadVideoToViewModel(id, title);

            loadVideosModal.close();
        });
    }

    registerLoadVideosModal();

    async function loadVideoToViewModel(id, title)
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        formData.append("videoId", id);
        formData.append("title", title);

        const response = await fetch('@Url.Action("LoadVideoToViewModel", "Material")', {
            method: "POST",
            body: formData
        });
        document.getElementById("load-videos-container").innerHTML = await response.text();
    }

    async function unloadVideoFromViewModel(idx)
    {
        const formData = new FormData(document.getElementById("create-course-form"));
        formData.append("idx", idx);

        const response = await fetch('@Url.Action("UnloadVideoFromViewModel", "Material")', {
            method: "POST",
            body: formData
        });

        document.getElementById("load-videos-container").innerHTML = await response.text();
    }
</script>
